clc
clear all
close all
%Input data
addpath('./functions/');
Gamma = 1.292;
T = 1.612;
Tav = 1.612;
Sa_ratios = 1;
SPO =[0.0422728605913 0.113278436093 0.123312633118 0.290448402 2133.26 2133.26 939.913228223];
dcroof = [0.0781	0.1323	0.1869	0.2448	0.2904];
noBlg = 0;
w = 1;
bUthd = [0.	0.	0.1	0.2	0.3];
mf = 6.87;
g = 9.81;
MC = 10;
iml = 0.1:0.1:1;
m = dlmread('inputs/idacm.tcl');
r = dlmread('inputs/idacr.tcl');
for j=1:3
    idac(j).m = m(j,:);
    idac(j).r = r(j,:);
end
dry = SPO(1);
xp=linspace( 1./(2*MC),1-1./(2*MC), MC);

for i = 1:length(dcdrlim_sample=logninv(xp,log(dcroof(i)),bUthd(i));roof)
    if bUthd(i) >0
        
        for j = 1:length(drlim_sample)
            [SaR50,bRSa,SaT50,bTSa]=SPO2IDAfragility(idac, dry,drlim_sample(j),0,mf,T,Gamma,g,MC);
            Sa50(j) = SaT50;
            bSa(j) = bTSa;
        end
    else
        [SaR50,bRSa,SaT50,bTSa]=SPO2IDAfragility(idac, dry,dcroof(i),0,mf,T,Gamma,g,MC);
        Sa50 = ones(1,MC)*SaT50;
        bSa = ones(1,MC)*bTSa;
    end
    Sa{i} = Sa50;
    b{i} = bSa;
    clear Sa50 bSa
end

for i=1:MC
    LR(i,:) = damage_to_loss(Sa, b, i, iml);
    hold on
    plot(iml,LR(i,:))
end

LR50s=mean(LR)